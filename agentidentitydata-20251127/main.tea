/**
 *
 */
import Util;
import OpenApi;
import OpenApiUtil;
import EndpointUtil;

extends OpenApi;


init(config: OpenApi.Config){
  super(config);
  @endpointRule = '';
  
  checkConfig(config);
  @endpoint = getEndpoint('agentidentitydata', @regionId, @endpointRule, @network, @suffix, @endpointMap, @endpoint);
}

function getEndpoint(productId: string, regionId: string, endpointRule: string, network: string, suffix: string, endpointMap: map[string]string, endpoint: string) throws: string{
  if (!Util.empty(endpoint)) {
    return endpoint;
  }
  
  if (!Util.isUnset(endpointMap) && !Util.empty(endpointMap[regionId])) {
    return endpointMap[regionId];
  }
  return EndpointUtil.getEndpointRules(productId, regionId, endpointRule, network, suffix);
}

model AssumeRoleForWorkloadIdentityRequest {
  durationSeconds?: string(name='DurationSeconds', example='3600'),
  policy?: string(name='Policy', example='{"Statement": [{"Action": ["*"],"Effect": "Allow","Resource": ["*"]}],"Version":"1"}'),
  roleSessionName?: string(name='RoleSessionName', example='session-name'),
  workloadAccessToken?: string(name='WorkloadAccessToken', example='eyAgImFsZyI6ICJSUzI1NiIsIC****'),
}

model AssumeRoleForWorkloadIdentityResponseBody = {
  assumedRoleUser?: {
    arn?: string(name='Arn', example='acs:ram::113511544585****:role/testoidc/TestOidcAssumedRoleSession'),
    assumedRoleId?: string(name='AssumedRoleId', example='33157794895460****'),
  }(name='AssumedRoleUser'),
  credentials?: {
    accessKeyId?: string(name='AccessKeyId', example='STS.NTTcrF2UNgeshFRTj9i7hpkah'),
    accessKeySecret?: string(name='AccessKeySecret', example='3fNFJk4UA6KLEG2GXiBe9ZE43ejFRJsea1yT1rguTVY6'),
    expiration?: string(name='Expiration', example='2025-04-28T03:06:19Z'),
    securityToken?: string(name='SecurityToken', example='CAIShwJ1q6Ft5B2yfSjIr5bSEsj4g7BihPWGWHz****'),
  }(name='Credentials'),
  requestId?: string(name='RequestId', example='B7F68680-F3FE-5BF1-A824-4DE0B1AC9B23'),
  workloadContextInfo?: {
    userContext?: {
      jwtClaims?: {
        audiences?: string(name='Audiences', example='["test-aud","test-aud-2"]'),
        issuer?: string(name='Issuer', example='https://oauth.aliyun.com'),
        subject?: string(name='Subject', example='externalUser'),
      }(name='JwtClaims'),
      userId?: string(name='UserId', example='externalUser'),
    }(name='UserContext'),
    workloadIdentityArn?: string(name='WorkloadIdentityArn', example='acs:agentidentity:cn-beijing:1778*****8462:workloadidentitydirectory/default/workloadidentity/workload-bc7***'),
  }(name='WorkloadContextInfo'),
}

model AssumeRoleForWorkloadIdentityResponse = {
  headers?: map[string]string(name='headers'),
  statusCode?: int32(name='statusCode'),
  body?: AssumeRoleForWorkloadIdentityResponseBody(name='body'),
}

/**
 * @summary 获取工作负载访问令牌
 *
 * @param request AssumeRoleForWorkloadIdentityRequest
 * @param runtime runtime options for this request RuntimeOptions
 * @return AssumeRoleForWorkloadIdentityResponse
 */
async function assumeRoleForWorkloadIdentityWithOptions(request: AssumeRoleForWorkloadIdentityRequest, runtime: Util.RuntimeOptions): AssumeRoleForWorkloadIdentityResponse {
  Util.validateModel(request);
  var body : map[string]any = {};
  if (!Util.isUnset(request.durationSeconds)) {
    body['DurationSeconds'] = request.durationSeconds;
  }
  if (!Util.isUnset(request.policy)) {
    body['Policy'] = request.policy;
  }
  if (!Util.isUnset(request.roleSessionName)) {
    body['RoleSessionName'] = request.roleSessionName;
  }
  if (!Util.isUnset(request.workloadAccessToken)) {
    body['WorkloadAccessToken'] = request.workloadAccessToken;
  }
  var req = new OpenApi.OpenApiRequest{ 
    body = OpenApiUtil.parseToMap(body),
  };
  var params = new OpenApi.Params{
    action = 'AssumeRoleForWorkloadIdentity',
    version = '2025-11-27',
    protocol = 'HTTPS',
    pathname = '/',
    method = 'POST',
    authType = 'Anonymous',
    style = 'RPC',
    reqBodyType = 'formData',
    bodyType = 'json',
  };
  return doRPCRequest(params.action, params.version, params.protocol, params.method, params.authType, params.bodyType, req, runtime);
}

/**
 * @summary 获取工作负载访问令牌
 *
 * @param request AssumeRoleForWorkloadIdentityRequest
 * @return AssumeRoleForWorkloadIdentityResponse
 */
async function assumeRoleForWorkloadIdentity(request: AssumeRoleForWorkloadIdentityRequest): AssumeRoleForWorkloadIdentityResponse {
  var runtime = new Util.RuntimeOptions{};
  return assumeRoleForWorkloadIdentityWithOptions(request, runtime);
}

model CompleteResourceTokenAuthRequest {
  sessionURI?: string(name='SessionURI', example='urn:ietf:params:oauth:request_uri:3030cabc-****-****-****-d0054944102a'),
  userIdentifier?: {
    userId?: string(name='UserId', example='externalUser'),
    userJWT?: string(name='UserJWT', example='eyAgImFsZyI6ICJSU****'),
  }(name='UserIdentifier'),
}

model CompleteResourceTokenAuthShrinkRequest {
  sessionURI?: string(name='SessionURI', example='urn:ietf:params:oauth:request_uri:3030cabc-****-****-****-d0054944102a'),
  userIdentifierShrink?: string(name='UserIdentifier'),
}

model CompleteResourceTokenAuthResponseBody = {
  requestId?: string(name='RequestId', example='6A3344F3-BFA1-5BCB-B5F5-17572C0D5586'),
}

model CompleteResourceTokenAuthResponse = {
  headers?: map[string]string(name='headers'),
  statusCode?: int32(name='statusCode'),
  body?: CompleteResourceTokenAuthResponseBody(name='body'),
}

/**
 * @summary 确认用户授权会话已完成
 *
 * @param tmpReq CompleteResourceTokenAuthRequest
 * @param runtime runtime options for this request RuntimeOptions
 * @return CompleteResourceTokenAuthResponse
 */
async function completeResourceTokenAuthWithOptions(tmpReq: CompleteResourceTokenAuthRequest, runtime: Util.RuntimeOptions): CompleteResourceTokenAuthResponse {
  Util.validateModel(tmpReq);
  var request = new CompleteResourceTokenAuthShrinkRequest{};
  OpenApiUtil.convert(tmpReq, request);
  if (!Util.isUnset(tmpReq.userIdentifier)) {
    request.userIdentifierShrink = OpenApiUtil.arrayToStringWithSpecifiedStyle(tmpReq.userIdentifier, 'UserIdentifier', 'json');
  }
  var body : map[string]any = {};
  if (!Util.isUnset(request.sessionURI)) {
    body['SessionURI'] = request.sessionURI;
  }
  if (!Util.isUnset(request.userIdentifierShrink)) {
    body['UserIdentifier'] = request.userIdentifierShrink;
  }
  var req = new OpenApi.OpenApiRequest{ 
    body = OpenApiUtil.parseToMap(body),
  };
  var params = new OpenApi.Params{
    action = 'CompleteResourceTokenAuth',
    version = '2025-11-27',
    protocol = 'HTTPS',
    pathname = '/',
    method = 'POST',
    authType = 'AK',
    style = 'RPC',
    reqBodyType = 'formData',
    bodyType = 'json',
  };
  return callApi(params, req, runtime);
}

/**
 * @summary 确认用户授权会话已完成
 *
 * @param request CompleteResourceTokenAuthRequest
 * @return CompleteResourceTokenAuthResponse
 */
async function completeResourceTokenAuth(request: CompleteResourceTokenAuthRequest): CompleteResourceTokenAuthResponse {
  var runtime = new Util.RuntimeOptions{};
  return completeResourceTokenAuthWithOptions(request, runtime);
}

model GetResourceAPIKeyRequest {
  resourceCredentialProviderName?: string(name='ResourceCredentialProviderName', example='test-api-key-provider'),
  workloadAccessToken?: string(name='WorkloadAccessToken', example='eyAgImFsZyI6ICJSUzI1N****'),
}

model GetResourceAPIKeyResponseBody = {
  APIKey?: string(name='APIKey', example='sk-ds*****'),
  requestId?: string(name='RequestId', example='6E444C1B-1106-56A8-81E0-E3B049BF44AD'),
}

model GetResourceAPIKeyResponse = {
  headers?: map[string]string(name='headers'),
  statusCode?: int32(name='statusCode'),
  body?: GetResourceAPIKeyResponseBody(name='body'),
}

/**
 * @summary 获取下游资源的 API 密钥
 *
 * @param request GetResourceAPIKeyRequest
 * @param runtime runtime options for this request RuntimeOptions
 * @return GetResourceAPIKeyResponse
 */
async function getResourceAPIKeyWithOptions(request: GetResourceAPIKeyRequest, runtime: Util.RuntimeOptions): GetResourceAPIKeyResponse {
  Util.validateModel(request);
  var body : map[string]any = {};
  if (!Util.isUnset(request.resourceCredentialProviderName)) {
    body['ResourceCredentialProviderName'] = request.resourceCredentialProviderName;
  }
  if (!Util.isUnset(request.workloadAccessToken)) {
    body['WorkloadAccessToken'] = request.workloadAccessToken;
  }
  var req = new OpenApi.OpenApiRequest{ 
    body = OpenApiUtil.parseToMap(body),
  };
  var params = new OpenApi.Params{
    action = 'GetResourceAPIKey',
    version = '2025-11-27',
    protocol = 'HTTPS',
    pathname = '/',
    method = 'POST',
    authType = 'AK',
    style = 'RPC',
    reqBodyType = 'formData',
    bodyType = 'json',
  };
  return callApi(params, req, runtime);
}

/**
 * @summary 获取下游资源的 API 密钥
 *
 * @param request GetResourceAPIKeyRequest
 * @return GetResourceAPIKeyResponse
 */
async function getResourceAPIKey(request: GetResourceAPIKeyRequest): GetResourceAPIKeyResponse {
  var runtime = new Util.RuntimeOptions{};
  return getResourceAPIKeyWithOptions(request, runtime);
}

model GetResourceOAuth2TokenRequest {
  customParameters?: map[string]any(name='CustomParameters', example='{"param1": "test-param", "param2": "test-param2"}'),
  customState?: string(name='CustomState', example='user-defined-value'),
  forceAuthentication?: boolean(name='ForceAuthentication', example='False'),
  OAuth2Flow?: string(name='OAuth2Flow', example='USER_FEDERATION'),
  resourceCredentialProviderName?: string(name='ResourceCredentialProviderName', example='oauth_credential_provider'),
  resourceOAuth2ReturnURL?: string(name='ResourceOAuth2ReturnURL', example='https://example.com'),
  scopes?: [ string ](name='Scopes'),
  sessionURI?: string(name='SessionURI', example='urn:ietf:params:oauth:request_uri:43b7df1a-****-****-****-709375a44d8a'),
  workloadAccessToken?: string(name='WorkloadAccessToken', example='eyAgImFsZyI6ICJSUzI1N****'),
}

model GetResourceOAuth2TokenShrinkRequest {
  customParametersShrink?: string(name='CustomParameters', example='{"param1": "test-param", "param2": "test-param2"}'),
  customState?: string(name='CustomState', example='user-defined-value'),
  forceAuthentication?: boolean(name='ForceAuthentication', example='False'),
  OAuth2Flow?: string(name='OAuth2Flow', example='USER_FEDERATION'),
  resourceCredentialProviderName?: string(name='ResourceCredentialProviderName', example='oauth_credential_provider'),
  resourceOAuth2ReturnURL?: string(name='ResourceOAuth2ReturnURL', example='https://example.com'),
  scopesShrink?: string(name='Scopes'),
  sessionURI?: string(name='SessionURI', example='urn:ietf:params:oauth:request_uri:43b7df1a-****-****-****-709375a44d8a'),
  workloadAccessToken?: string(name='WorkloadAccessToken', example='eyAgImFsZyI6ICJSUzI1N****'),
}

model GetResourceOAuth2TokenResponseBody = {
  accessToken?: string(name='AccessToken', example='66a1a2****0b93v3'),
  authorizationURL?: string(name='AuthorizationURL', example='https://agentidentity.cn-beijing.aliyuncs.com/*****'),
  requestId?: string(name='RequestId', example='173C69C9-9C07-5B25-9477-603A33E5DA32'),
  sessionStatus?: string(name='SessionStatus', example='IN_PROGRESS'),
  sessionURI?: string(name='SessionURI', example='urn:ietf:params:oauth:request_uri:43b7df1a-****-****-****-709375a44d8a'),
}

model GetResourceOAuth2TokenResponse = {
  headers?: map[string]string(name='headers'),
  statusCode?: int32(name='statusCode'),
  body?: GetResourceOAuth2TokenResponseBody(name='body'),
}

/**
 * @summary 获取下游资源的 OAuth 2.0 访问令牌
 *
 * @param tmpReq GetResourceOAuth2TokenRequest
 * @param runtime runtime options for this request RuntimeOptions
 * @return GetResourceOAuth2TokenResponse
 */
async function getResourceOAuth2TokenWithOptions(tmpReq: GetResourceOAuth2TokenRequest, runtime: Util.RuntimeOptions): GetResourceOAuth2TokenResponse {
  Util.validateModel(tmpReq);
  var request = new GetResourceOAuth2TokenShrinkRequest{};
  OpenApiUtil.convert(tmpReq, request);
  if (!Util.isUnset(tmpReq.customParameters)) {
    request.customParametersShrink = OpenApiUtil.arrayToStringWithSpecifiedStyle(tmpReq.customParameters, 'CustomParameters', 'json');
  }
  if (!Util.isUnset(tmpReq.scopes)) {
    request.scopesShrink = OpenApiUtil.arrayToStringWithSpecifiedStyle(tmpReq.scopes, 'Scopes', 'json');
  }
  var body : map[string]any = {};
  if (!Util.isUnset(request.customParametersShrink)) {
    body['CustomParameters'] = request.customParametersShrink;
  }
  if (!Util.isUnset(request.customState)) {
    body['CustomState'] = request.customState;
  }
  if (!Util.isUnset(request.forceAuthentication)) {
    body['ForceAuthentication'] = request.forceAuthentication;
  }
  if (!Util.isUnset(request.OAuth2Flow)) {
    body['OAuth2Flow'] = request.OAuth2Flow;
  }
  if (!Util.isUnset(request.resourceCredentialProviderName)) {
    body['ResourceCredentialProviderName'] = request.resourceCredentialProviderName;
  }
  if (!Util.isUnset(request.resourceOAuth2ReturnURL)) {
    body['ResourceOAuth2ReturnURL'] = request.resourceOAuth2ReturnURL;
  }
  if (!Util.isUnset(request.scopesShrink)) {
    body['Scopes'] = request.scopesShrink;
  }
  if (!Util.isUnset(request.sessionURI)) {
    body['SessionURI'] = request.sessionURI;
  }
  if (!Util.isUnset(request.workloadAccessToken)) {
    body['WorkloadAccessToken'] = request.workloadAccessToken;
  }
  var req = new OpenApi.OpenApiRequest{ 
    body = OpenApiUtil.parseToMap(body),
  };
  var params = new OpenApi.Params{
    action = 'GetResourceOAuth2Token',
    version = '2025-11-27',
    protocol = 'HTTPS',
    pathname = '/',
    method = 'POST',
    authType = 'AK',
    style = 'RPC',
    reqBodyType = 'formData',
    bodyType = 'json',
  };
  return callApi(params, req, runtime);
}

/**
 * @summary 获取下游资源的 OAuth 2.0 访问令牌
 *
 * @param request GetResourceOAuth2TokenRequest
 * @return GetResourceOAuth2TokenResponse
 */
async function getResourceOAuth2Token(request: GetResourceOAuth2TokenRequest): GetResourceOAuth2TokenResponse {
  var runtime = new Util.RuntimeOptions{};
  return getResourceOAuth2TokenWithOptions(request, runtime);
}

model GetWorkloadAccessTokenRequest {
  workloadIdentityName?: string(name='WorkloadIdentityName', example='test-workload-identity'),
}

model GetWorkloadAccessTokenResponseBody = {
  requestId?: string(name='RequestId', example='1E85BA86-0955-5841-9679-9C33867E460D'),
  workloadAccessToken?: string(name='WorkloadAccessToken', example='eyAgImFsZyI6ICJSUzI1N****'),
}

model GetWorkloadAccessTokenResponse = {
  headers?: map[string]string(name='headers'),
  statusCode?: int32(name='statusCode'),
  body?: GetWorkloadAccessTokenResponseBody(name='body'),
}

/**
 * @summary 获取工作负载访问令牌
 *
 * @param request GetWorkloadAccessTokenRequest
 * @param runtime runtime options for this request RuntimeOptions
 * @return GetWorkloadAccessTokenResponse
 */
async function getWorkloadAccessTokenWithOptions(request: GetWorkloadAccessTokenRequest, runtime: Util.RuntimeOptions): GetWorkloadAccessTokenResponse {
  Util.validateModel(request);
  var body : map[string]any = {};
  if (!Util.isUnset(request.workloadIdentityName)) {
    body['WorkloadIdentityName'] = request.workloadIdentityName;
  }
  var req = new OpenApi.OpenApiRequest{ 
    body = OpenApiUtil.parseToMap(body),
  };
  var params = new OpenApi.Params{
    action = 'GetWorkloadAccessToken',
    version = '2025-11-27',
    protocol = 'HTTPS',
    pathname = '/',
    method = 'POST',
    authType = 'AK',
    style = 'RPC',
    reqBodyType = 'formData',
    bodyType = 'json',
  };
  return callApi(params, req, runtime);
}

/**
 * @summary 获取工作负载访问令牌
 *
 * @param request GetWorkloadAccessTokenRequest
 * @return GetWorkloadAccessTokenResponse
 */
async function getWorkloadAccessToken(request: GetWorkloadAccessTokenRequest): GetWorkloadAccessTokenResponse {
  var runtime = new Util.RuntimeOptions{};
  return getWorkloadAccessTokenWithOptions(request, runtime);
}

model GetWorkloadAccessTokenForJWTRequest {
  userToken?: string(name='UserToken', example='eyAgImFsZyI6ICJSUzI1NiIsI*******'),
  workloadIdentityName?: string(name='WorkloadIdentityName', example='test-workload-identity'),
}

model GetWorkloadAccessTokenForJWTResponseBody = {
  requestId?: string(name='RequestId', example='D679769C-957B-586A-AD00-5C2064DAFA7D'),
  workloadAccessToken?: string(name='WorkloadAccessToken', example='eyAgImFsZyI6ICJSUzI1N****'),
}

model GetWorkloadAccessTokenForJWTResponse = {
  headers?: map[string]string(name='headers'),
  statusCode?: int32(name='statusCode'),
  body?: GetWorkloadAccessTokenForJWTResponseBody(name='body'),
}

/**
 * @summary 获取工作负载访问令牌
 *
 * @param request GetWorkloadAccessTokenForJWTRequest
 * @param runtime runtime options for this request RuntimeOptions
 * @return GetWorkloadAccessTokenForJWTResponse
 */
async function getWorkloadAccessTokenForJWTWithOptions(request: GetWorkloadAccessTokenForJWTRequest, runtime: Util.RuntimeOptions): GetWorkloadAccessTokenForJWTResponse {
  Util.validateModel(request);
  var body : map[string]any = {};
  if (!Util.isUnset(request.userToken)) {
    body['UserToken'] = request.userToken;
  }
  if (!Util.isUnset(request.workloadIdentityName)) {
    body['WorkloadIdentityName'] = request.workloadIdentityName;
  }
  var req = new OpenApi.OpenApiRequest{ 
    body = OpenApiUtil.parseToMap(body),
  };
  var params = new OpenApi.Params{
    action = 'GetWorkloadAccessTokenForJWT',
    version = '2025-11-27',
    protocol = 'HTTPS',
    pathname = '/',
    method = 'POST',
    authType = 'AK',
    style = 'RPC',
    reqBodyType = 'formData',
    bodyType = 'json',
  };
  return callApi(params, req, runtime);
}

/**
 * @summary 获取工作负载访问令牌
 *
 * @param request GetWorkloadAccessTokenForJWTRequest
 * @return GetWorkloadAccessTokenForJWTResponse
 */
async function getWorkloadAccessTokenForJWT(request: GetWorkloadAccessTokenForJWTRequest): GetWorkloadAccessTokenForJWTResponse {
  var runtime = new Util.RuntimeOptions{};
  return getWorkloadAccessTokenForJWTWithOptions(request, runtime);
}

model GetWorkloadAccessTokenForUserIdRequest {
  userId?: string(name='UserId', example='externalUser1'),
  workloadIdentityName?: string(name='WorkloadIdentityName', example='test-workload-identity'),
}

model GetWorkloadAccessTokenForUserIdResponseBody = {
  requestId?: string(name='RequestId', example='1E85BA86-0955-5841-9679-9C33867E460D'),
  workloadAccessToken?: string(name='WorkloadAccessToken', example='eyAgImFsZyI6ICJSUzI1N****'),
}

model GetWorkloadAccessTokenForUserIdResponse = {
  headers?: map[string]string(name='headers'),
  statusCode?: int32(name='statusCode'),
  body?: GetWorkloadAccessTokenForUserIdResponseBody(name='body'),
}

/**
 * @summary 获取工作负载访问令牌
 *
 * @param request GetWorkloadAccessTokenForUserIdRequest
 * @param runtime runtime options for this request RuntimeOptions
 * @return GetWorkloadAccessTokenForUserIdResponse
 */
async function getWorkloadAccessTokenForUserIdWithOptions(request: GetWorkloadAccessTokenForUserIdRequest, runtime: Util.RuntimeOptions): GetWorkloadAccessTokenForUserIdResponse {
  Util.validateModel(request);
  var body : map[string]any = {};
  if (!Util.isUnset(request.userId)) {
    body['UserId'] = request.userId;
  }
  if (!Util.isUnset(request.workloadIdentityName)) {
    body['WorkloadIdentityName'] = request.workloadIdentityName;
  }
  var req = new OpenApi.OpenApiRequest{ 
    body = OpenApiUtil.parseToMap(body),
  };
  var params = new OpenApi.Params{
    action = 'GetWorkloadAccessTokenForUserId',
    version = '2025-11-27',
    protocol = 'HTTPS',
    pathname = '/',
    method = 'POST',
    authType = 'AK',
    style = 'RPC',
    reqBodyType = 'formData',
    bodyType = 'json',
  };
  return callApi(params, req, runtime);
}

/**
 * @summary 获取工作负载访问令牌
 *
 * @param request GetWorkloadAccessTokenForUserIdRequest
 * @return GetWorkloadAccessTokenForUserIdResponse
 */
async function getWorkloadAccessTokenForUserId(request: GetWorkloadAccessTokenForUserIdRequest): GetWorkloadAccessTokenForUserIdResponse {
  var runtime = new Util.RuntimeOptions{};
  return getWorkloadAccessTokenForUserIdWithOptions(request, runtime);
}

